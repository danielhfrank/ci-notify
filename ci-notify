#!/usr/bin/env ruby

PENDING=2
NO_STATUS=3
return_txt = ""

loop do
  return_txt = `hub ci-status -v`
  break unless [PENDING, NO_STATUS].include?($?.exitstatus)
  sleep(1)
end

status_txt, url = return_txt.split(':', 2).map{|s| s.strip}
url_args = status_txt == 'success' ? '' : "-open #{url}"

exec("terminal-notifier -message 'Build #{status_txt}' -title 'ci-notify' #{url_args}") 
